CHANGELOG Meresco-Components
============================

version: 3.4.7 -> 3.4.7.1
date:    2011-02-11


Boundary checks back in docset intersect
----------------------------------------
A boundary check was removed and is no inserted back into docset.h
(2011-02-11, 3.4.7-Edurep)


version: 3.4.6 -> 3.4.7
date:    2011-02-02


srw:record in srw:extraRecordData
---------------------------------
Extra recordData returned in SRU/W responses didn't have a namespace, and
therefor was in "default" namespace. See the following example.

Old style: <srw:record> <srw:recordSchema>dc</srw:recordSchema>
<srw:recordPacking>xml</srw:recordPacking> <srw:recordData> .. </srw:recordData>
<srw:extraRecordData> <recordData recordSchema="extra"> <!-- no namespace --> ..
</recordData> </srw:extraRecordData> </srw:record>

The SruHandler can now be configured to return extraRecordData as a srw:record.
See the following example:

New style: <srw:record> <srw:recordSchema>dc</srw:recordSchema>
<srw:recordPacking>xml</srw:recordPacking> <srw:recordData> .. </srw:recordData>
<srw:extraRecordData> <srw:record> <srw:recordSchema>extra</srw:recordSchema>
<srw:recordPacking>xml</srw:recordPacking> <srw:recordData> .. </srw:recordData>
</srw:record> </srw:extraRecordData> </srw:record>

To avoid backwards incompatibility the old version is still available.
(2011-02-01, 3.4.6
)

Removed wrong optimization in docset
------------------------------------
Removed wrong optimization in docset
(2011-01-25, 3.4.6-MWE)

Added an hierarchical drilldown
-------------------------------
The hierarchical drilldown can be used besides the normal drilldown. The
hierarchicaldrilldown needs a list with the nested drilldown fields. It returns
a nested dictionary with fieldnames and terms and for every term the name, count
and extra the nested drilldown.
(2011-01-25, 3.4.6-MWE)

Traceback reporting more complete.
----------------------------------
Removed limits from tracebacks and passing error with traceback to Suspend
object in Msgbox.processFile
(2011-01-06, 3.4.6-Edurep)

Detect out-of-sync tracker
--------------------------
Lucene index and docIdTracker sometimes differ due to unexpected server crash.
This mismatch is detected before starting. Optimization of the index will
resolve the problem.
(2011-01-04, 3.4.6-Edurep)

Converter not calling _canConvert when not needed; extended fromKwarg approach to using Converter
-------------------------------------------------------------------------------------------------
A subclass of Converter no longer needs to provide _canConvert when the
conversion is carried out on a specific kwarg (via fromKwarg parameter);
Deprecation warning with respect to old style use now extended to all
subclasses; moved a number of tests to path that properly corresponds to class
under test.
(2010-12-16, 3.4.6-Edurep)

SessionHandler callable passthrough
-----------------------------------
The SessionHandler passes callable objects through to its caller unchanged. This
is required to support asyncany and asyncdo calls.
(2010-12-07, 3.4.6-TUD)

Fileserver's Expires header calculation simplified
--------------------------------------------------
The http FileServer Expires (and Date) headers calculation has been simplified
and more thoroughly tested.
(2010-10-14, 3.4.2-CQ2)

==============================================================================

version: 3.4.5 -> 3.4.6
date:    2010-12-06


Introduced PersistentSortedIntegerList as a faster replacement for SortedFileList
---------------------------------------------------------------------------------
Introduced PersistentSortedIntegerList that adds transparant persistency for an
IntegerList, which was extended to also support 64 bit integers. The persistency
mechanism was designed to be faster than the existing SortedFileList, especially
for deletes.
(2010-12-03, 3.4.4-Edurep)

RSS Component now uses WebQuery
-------------------------------
The RSS Component used to construct its own CQL-query. To keep website
query-construction and RSS query-construction in sync WebQuery is now also used
in the RSS Component. Additionally filters, like drilldown, can be communicated
by using "filter" arguments the the http-request.
(2010-11-18, 3.4.5-MWE)

Exception thrown on rename will now be written to the .error file
-----------------------------------------------------------------
An error on the rename would cause the msgbox to crash. Exception now will be
handled and written to the .error file in the done directory. The msgbox will
not be removed anymore from the reactor on errors.
(2010-11-16, 2.23.6-TUD)

Adds support for faster drop-in-replacement of Document.addToIndexWith
----------------------------------------------------------------------
The Python implementation of addToIndexWith can now optionally be replaced with
the faster C++ implementation in the lucenegcjutil package.
(2010-07-07, 3.0-Edurep)


==============================================================================

version: 3.4.4 -> 3.4.5
date:    2010-11-03


Now also accept unicode from lxml 2
-----------------------------------
Lxml 2 has a different way of treating string or unicode results, the string
results were already adapted to the lxml 2 way of presenting them. Now unicode
results can be handled correctly as well.
(2010-11-03, 3.4.4-Edurep)

Duplicate field filtering removed
---------------------------------
Filtering of duplicate keys is removed. (Was introduced in 3.4.4) The generated
XML will eventually create a LuceneDocument, the sequence of values is important
for phrasequeries.
(2010-10-27, 3.4.4-Edurep)

Fixed an escaping bug in the reindex component
----------------------------------------------
The reindex components now escapes identifiers using escaping.escapeFilename. An
identifier with a newline was not escaped and seen as a new record for the
reindex component. This is now fixed with escaping the identifier from storage
and unescaped when retrieving the record in the reindex process.
(2010-10-26, 3.4.4-NED)

==============================================================================

version: 3.4.3 -> 3.4.4
date:    2010-10-12


Kwargs improvement to use the new standard
------------------------------------------
Fixed some components to use the new style kwargs as used in meresco for add and
delete calls. Upgraded the storagecomponent to use the new names 'identifier'
and 'partname' as arguments.
(2010-10-21, 3.4.3-Edurep)

IpFilter component is now testable
----------------------------------
This changeset allows testing of configured IpFilter in a Meresco based server.
With the setting of a special HTTP Header, the IpFilter component will fake the
ip-address to be something else. The HTTP Header is
"X-Meresco-Ipfilter-Fake-Ip". For security reasons this Header is only allowed
from localhost.
(2010-10-20, 3.3-Edurep)

Fixed bugs in fields2xml
------------------------
When deleting a record it has no fields. Because of that addField is not called
and an self.any.add is not needed. Also fixed that an key,value pair is not
added twice
(2010-10-08, 3.3-Edurep)

Bugfix Fields2Xml for partly same keys
--------------------------------------
Fields2Xml generated invalid xml for keys that are partly the same, like
'key.sub' and 'keyname.othersub', it generated xml that looked like
<key><sub>data</sub><name><othersub>data</othersub></key>.

This bug is solved with this changeset.
(2010-10-07, 3.3-Edurep)

Removed the timings of autocomplete.
------------------------------------
Removed the timings of autocomplete.
(2010-10-07, 3.3-Edurep)

WebRequestServer removed
------------------------
WebRequestServer is moved to meresco-oai.
(2010-10-04, 3.3-Edurep)

Check if identifier not in suspended before adding in Msgbox
------------------------------------------------------------
Added a file to the Msgbox is only allowed when the previous file no longer
exists and the identifier is not suspended anymore. This fixes a bug in the
Msgbox which will cause the server to crash.
(2010-09-30, 3.3-Edurep)

Add waits while file present in out directory + cleanups
--------------------------------------------------------
Writing file to outDirectory is suspended as long as that file already exists.
'_purge' and '_forgivingRemove' were no longer necessary and therefore removed.
Exception handling simplified.
(2010-09-21, 3.1.5-Edurep)

Delete incoming file before sending ack
---------------------------------------
The Msgbox removes the original file before sending an ack to the client. This
changesets fixed a bug when incoming files are removed when an ack is already
send and the client overwrites the previous request, which is later remove by
the Msgbox
(2010-09-20, 3.1.5-Edurep)

Concurrent request possible using Msgbox
----------------------------------------
While adding concurrent request to an asynchronous Msgbox, every second request
will be waiting until the first is completly processed. Every other request
about the same identifier will wait, all other request will be processed as
excepted
(2010-09-17, 3.1.5-Edurep)

Added optional recordIdentifier to sru repsonse
-----------------------------------------------
An sru query with version 2.1 will give an response with the recordIdentifier in
the record as specified in sru 1.2
(2010-09-15, 3.1.3-Edurep)

Catching CQLTokenizerException from parseString
-----------------------------------------------
CQLTokenizerException raised from parseString is now converted to the
appropriate SruException QUERY_FEATURE_UNSUPPORTED
(2010-09-13, 3.1.3-Edurep)

Fix for suspend bug in Msgbox
-----------------------------
Two concurrent request to the Msgbox can cause the suspend object to be used
twice for different request. That results in a suspende directorywatcher which
is never resumed. After this, the msgbox will not handle any more request and
must be restarted. Now the suspend object is not known to the msgbox anymore,
when it's used and therefore it cannot be used by another request at 'mostly'
the same time.
(2010-09-08, 3.1.3-Edurep-Bugfix)

==============================================================================

version: 3.4.2 -> 3.4.3
date:    2010-10-12

Old behaviour on missing fromKwarg
----------------------------------
The converters now display their old behaviour if the specified fromKwarg is 
not present in the kwargs.
(2010-10-12, 3.4.2-NED)

==============================================================================

version: 3.4.1 -> 3.4.2
date:    2010-09-28

! The interface of SRUTermDrilldown.extraResponseData has changed in a 
  not-backwards-compatible way (as described below). Even so, this will
  not break the majority of existing applications (in which SRUTermDrilldown
  is just simply observing SruHandler, which was updated correspondingly).

extraResponseData now takes docset parameter
--------------------------------------------
extraResponseData now takes docset parameter (instead of cqlAbstractSyntaxTree
parameter) to prevent distinct components having to call docsetFromQuery more
than once.
(2010-09-27, 3.4.1-NED)

==============================================================================

version: 3.4 -> 3.4.1
date:    2010-09-27

GC no longer disabled inside DocSet::forTerm
--------------------------------------------
Fixed memory leak on server startup by no longer disabling GC (which seemed a
valid performance improvement).
(2010-09-27, 3.4-NED)

==============================================================================

version: 3.3 -> 3.4
date:    2010-09-20

!! Meresco-components 3.4 is not backwards compatible with Meresco 
   Compontents 3.3. The "Consistent naming of add parameters" change breaks
   compatibility(see below).

Use Meresco Xml package instead of CQ2Utils/XmlUtils
----------------------------------------------------
The xmlutils are extracted from the CQ2Utils project into a separate Meresco
project called Meresco-Xml. This changeset alters the imports needed for the
use of Meresco-Xml. It also removes some unnecessary imports.

_luceneDelete deletes all Lucene documents with given identifier 
----------------------------------------------------------------
Recognizing that - as the consequence of an historical bug - there may be
more Lucene records with the same identifier, _luceneDelete will now delete
all of them (instead of giving up on deleting anything alltogether).

Consistent naming of add parameters 
-----------------------------------
To stimulate the use of kwargs in add calls, matching add methods on several
components now take consistently named keyword arguments. 
Also: adapted xmlpump converters to take a fromKwarg and toKwarg parameter to 
make conversion more explicit.

DocSet.fromQuery catches and reraises Lucene's TooManyClauses exception
-----------------------------------------------------------------------
It was possible to cause a process to abort by calling DocSet.fromQuery with
a PrefixQuery that caused a TooManyClauses exception. This situation will now
result in an appropriate Python RuntimeError.

